
<!DOCTYPE html>
<html>
<body>

<canvas id="fissionGameCanvas" width="600" height="600" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>
<p > </p>

<button id="startbutton" onmousedown="mouseDown(energy)" onmouseup="mouseUp();this.disabled=true"> Fire a neutron!</button>

<script>

var canvas = document.getElementById('fissionGameCanvas');
var ctx = canvas.getContext("2d");


function draw_bar(x,y,w,h){
	ctx.beginPath();
	ctx.rect(x, y, w, h);
	ctx.stroke();
	ctx.fillStyle = "#C4C3C2";
	ctx.fill();
	ctx.closePath();	
}

var energy = 0;
var bar_x = canvas.width*0.15;

function incE(){

  energy = energy+1;
  bar_x += canvas.width*0.35/16 ;

  // Reset the charge up bar so that it doesnt get 1e9 speed
  if ( energy > 30 ){  
    draw_scene( r, resImg, b, n, c, cannonImg, u, u235Img );
    energy = 0;
    bar_x = canvas.width*0.15;
  }

  draw_bar(bar_x,0,5,canvas.height*0.25);

}

// Must define energy interval id ``eid'' out here so that both the mouseDown
// and the mouseUp functions can access it
var eid;
function mouseDown(energy){
	eid = setInterval(function(){energy = incE(energy);},30);
}
function mouseUp(){
	clearInterval(eid);
	myFunction(energy/4);
	energy = 0;
}

function draw_neutron(x,y){
	ctx.beginPath();
	ctx.arc(x, y, 10, 0, 2 * Math.PI);
	ctx.stroke();
	ctx.fillStyle = "red";
	ctx.fill();
	ctx.closePath();

}

function clear(){
	ctx.clearRect(0,0,canvas.width,canvas.height);
}


function draw_scene( r, resImg, b, n, c, cannonImg, u, u235Img ){
  clear();
  drawImg( r, resImg );
  draw_bar(b.x,b.y,b.w,b.h);
  if ( n != false ){ draw_neutron(n.x,n.y); }
  drawImg(c,cannonImg);
  if ( u != false ){ drawImg(u,u235Img); }
}




function update_neutron(u,b,grav,c,n,refreshID,cannonImg,u235Img,u235frag1Img,u235frag2Img,r,resImg){

  draw_scene( r, resImg, b, n, c, cannonImg, u, u235Img );

  n.x += n.vx; n.y -= n.vy; n.vy -= grav;

  if( n.y > u.y + u.w*0.5 && n.x > u.x && n.x < u.x + u.w ){
    fission_event(u,u235frag1Img,u235frag2Img,b,c,u,u235Img,cannonImg,r,resImg);
    clearInterval(refreshID);
    bar_x = canvas.width*0.15;
  }
  if( ( n.y > b.y && n.x > b.x && n.x < b.x + b.w ) ||  // Hit the barrier
        n.x > canvas.width + 50                     ||  // Went too far right
        n.y > canvas.height*0.95 ){                     // Hit the ground
    clearInterval(refreshID); 
    bar_x = canvas.width*0.15; 
    startbutton.disabled = false;
  }

  return n;
}



function wiggleHelper( u, b, c, u235Img, cannonImg, r, resImg ){
        draw_scene( r, resImg, b, false, c, cannonImg, u, u235Img );
}


function wiggleU235(u,b,c,u235Img,cannonImg,r,resImg){
  u.x += 5; u.y += 5;
  draw_scene( r, resImg, b, false, c, cannonImg, u, u235Img );
  u.x -= 5; u.y -= 5;
  setTimeout(function(){ wiggleHelper(u,b,c,u235Img,cannonImg,r,resImg ); },50)
  u.x += 6; u.y -= 6;
  setTimeout(function(){ wiggleHelper(u,b,c,u235Img,cannonImg,r,resImg ); },50)
  u.x -= 6; u.y += 6;
  setTimeout(function(){ wiggleHelper(u,b,c,u235Img,cannonImg,r,resImg ); },50)
  return u;
}


function fission_event(u,u235frag1Img,u235frag2Img,b,c,u,u235Img,cannonImg,r,resImg){
  var uf1 = { x : u.x, y : u.y, w : u.w*0.7, h : u.h*0.7};
  var uf2 = { x : u.x+u.w*0.1, y : u.y+u.w*0.1, w : u.w * 0.7, h : u.h*0.7};
  var jiggleID = setInterval(function(){
  u = wiggleU235(u, b, c, u235Img,cannonImg,r,resImg);},150);
  setTimeout(function(){
    clearInterval(jiggleID);
    draw_scene( r, resImg, b, false, c, cannonImg, false, u235Img );
    drawImg(uf1,u235frag1Img);
    drawImg(uf2,u235frag2Img);
    var move_frag_1ID = setInterval(function(){
      n = update_fragment1(uf1,u235frag1Img,uf2,u235frag2Img,b,c,move_frag_1ID,
                         u,u235Img,r,resImg);
    },10);
  },2000);	

}

function update_fragment1(uf1,u235frag1Img,uf2,u235frag2,b,c,move_frag_1ID,u,u235Img,r,resImg){

draw_scene( r, resImg, b, false, c, cannonImg, false, u235Img );

uf1.x -= 3; uf1.y -= 1; uf2.x += 1; uf2.y -= 4;

drawImg(uf1,u235frag1Img);
drawImg(uf2,u235frag2Img);
if(uf1.x < -200){clearInterval(move_frag_1ID); drawImg(u,u235Img);startbutton.disabled=false;}
}




	

function drawImg(x,Img){
	ctx.beginPath();
	ctx.drawImage(Img,x.x,x.y,x.w,x.h);
	ctx.closePath();
}




var resImg = new Image();
 resImg.src = 'resonance2.png';
//resImg.src = 'https://atomikit.tech/wp-content/custom-files/resonance2.png';

var cannonImg = new Image();
cannonImg.src = 'https://atomikit.tech/wp-content/custom-files/cannon.jpeg';
// cannonImg.src = 'cannon.jpeg';

var u235Img = new Image();
u235Img.src = 'https://atomikit.tech/wp-content/custom-files/u235.png';
 u235Img.src = 'u235.png';

var u235frag1Img = new Image();
u235frag1Img.src = 'https://atomikit.tech/wp-content/custom-files/u235frag1.png';
 u235frag1Img.src = 'u235frag1.png';

var u235frag2Img = new Image();
u235frag2Img.src = 'https://atomikit.tech/wp-content/custom-files/u235frag2.png';
 u235frag1Img.src = 'u235frag2.png';

var gravity = 0.01;
var c_W = canvas.width;	
var c_H = canvas.height;	

var b = { x : c_W*0.3,      y : c_H*0.4,    w : c_W*0.1,  h  : c_H*0.6,  };
var n = { x : c_W*0.1,      y : c_H*0.9,    vx : 0.5,     vy : 0 };
var u = { x : c_W*0.7,      y : c_H*0.8,    w  : c_W*0.15, h : c_W*0.15 };
var r = { x : c_W*0.15,     y : 0,          w  : c_W*0.7,  h : c_H*0.25 };
var c = { x : c_W*0.1 - 50, y : c_H*0.9-40, w  : 90,       h : 100 };


var ctx = canvas.getContext("2d");
ctx.font = "50px Times New Roman";
ctx.fillText("Welcome!",c_W*0.3,c_H*0.5);
startbutton.disabled=true;

setTimeout(function(){

  draw_scene( r, resImg, b, n, c, cannonImg, u, u235Img );
	startbutton.disabled=false;

},1500);

function myFunction(energy) {

	var n = { x : canvas.width*0.1, y : canvas.height*0.9, vx : 0.5, vy : energy, size : 10 };

	drawImg(c,cannonImg);
	draw_neutron(n.x,n.y);
	draw_bar(b.x,b.y,b.w,b.h);


	var refreshID = setInterval(function(){
		n = update_neutron(u,b,gravity,c,n,refreshID,cannonImg,u235Img,u235frag1Img,u235frag2Img,r,resImg);},1);
	draw_neutron(n.x,n.y);

}



</script> 

</body>
</html>
